name: Nightly Wheel builder
on:
  workflow_dispatch:
  schedule:
    # this cron is ran every Sunday at midnight UTC
    - cron: '0 0 * * 0'

jobs:
  upload_anaconda:
    name: Upload to Anaconda
    runs-on: ubuntu-latest
    # The artifacts cannot be uploaded on PRs, also disable scheduled CI runs on forks
    if: github.event_name != 'pull_request' && (github.event_name != 'schedule' || github.repository_owner == 'ipython')

    steps:
      - uses: actions/checkout@v6
      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: "3.14"
          cache: pip
          cache-dependency-path: |
            pyproject.toml
      - name: Install uv
        uses: astral-sh/setup-uv@v7
      - name: Try building with Python build
        if: runner.os != 'Windows'  # setup.py does not support sdist on Windows
        run: |
          uv pip install --system build
          python -m build

      - name: Upload wheel
        uses: scientific-python/upload-nightly-action@main
        with:
          artifacts_path: dist
          anaconda_nightly_upload_token: ${{secrets.UPLOAD_TOKEN}}
