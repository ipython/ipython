The function `embed_kernel` now have optional parameter `callback`,
which can be used by caller to get connection info.
